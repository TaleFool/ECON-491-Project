setwd("/Users/user/Desktop/ECON491project")
# Load necessary packages
library(tidyverse)
library(readxl)  # For reading Excel files
# Read PSID data
# Assuming the data is stored in a format like .rds, .csv, or .dta
psid_data <- psid_data <- read_excel("./data/psid_data.xlsx")
# Read PSID data
# Assuming the data is stored in a format like .rds, .csv, or .dta
psid_data <- psid_data <- read_excel("/Users/user/Desktop/ECON491project/data")
# Read PSID data
# Assuming the data is stored in a format like .rds, .csv, or .dta
psid_data <- psid_data <- read_excel("/Users/user/Desktop/ECON491project/data/J347114.xlsx")
View(psid_data)
# Create model dataset
model_df <- psid_data %>%
# Filter for individuals around age 35 in 2021
filter(ER34904 >= 34 & ER34904 <= 36) %>%  # Age in 2021
# Filter for individuals with valid income data in 2021
filter(!is.na(ER35049) | !is.na(ER35046)) %>%
# Select relevant variables
select(
# Identifiers
individual_id = ER30002,  # Person number
family_id_2021 = ER34901,  # 2021 family ID
# Outcome variables - income in 2021
income_2021 = ER35049,  # OFUM total taxable income
labor_income_2021 = ER35046,  # OFUM labor income
# Demographics
sex = ER32000,  # Sex of individual
age_2021 = ER34904,  # Age in 2021
relation_to_head = ER34903,  # Relationship to reference person
# Education
attended_college = ER34930,  # Whether attended college
college_degree = ER34934,  # Whether received college degree
years_education = ER34952,  # Years of completed education
# Family background
parents_poor = ER81141,  # Parents poor when growing up
# Wealth measures
wealth_2021 = ER81838,  # Wealth with equity
family_income_2020 = ER81775  # Total family income
)
# Clean the data: handle missing values, create derived variables
model_df <- model_df %>%
# Create appropriate outcome variable based on what's available
mutate(
final_income = coalesce(income_2021, labor_income_2021),
# Convert variables to correct types (Excel import may affect this)
sex = as.numeric(sex),
attended_college = as.numeric(attended_college),
college_degree = as.numeric(college_degree),
parents_poor = as.numeric(parents_poor),
# Create factor variables
sex_factor = factor(sex, levels = c(1, 2), labels = c("Male", "Female")),
college_factor = factor(attended_college, levels = c(1, 5), labels = c("Yes", "No")),
degree_factor = factor(college_degree, levels = c(1, 5), labels = c("Yes", "No")),
parents_poor_factor = factor(parents_poor, levels = c(1, 3, 5),
labels = c("Poor", "Average", "Well Off"))
) %>%
# Remove missing values in outcome
filter(!is.na(final_income))
# Examine the prepared dataset
summary(model_df)
View(model_df)
# Expanded model dataset including childhood variables
model_df <- psid_data %>%
# Filter for individuals around age 35 in 2021
filter(ER34904 >= 34 & ER34904 <= 36) %>%
# Filter for individuals with valid income data
filter(!is.na(ER35049) | !is.na(ER35046)) %>%
select(
# Identifiers
individual_id = ER30002,  # Person number
family_id_2021 = ER34901,  # 2021 family ID
# Outcome variables - income in 2021
income_2021 = ER35049,     # Total taxable income
labor_income_2021 = ER35046, # Labor income
# Current demographics
sex = ER32000,
age_2021 = ER34904,
relation_to_head = ER34903,
# Education
attended_college = ER34930,
college_degree = ER34934,
years_education = ER34952,
# Current family background
parents_poor = ER81141,
# Wealth measures
wealth_2021 = ER81838,
family_income_2020 = ER81775,
# CHILDHOOD VARIABLES (1990s)
# Family income when child was around 4-10 years old
family_income_90 = V18875,   # 1989 family money income
family_income_92 = V20175,   # 1990 family money income
# Parents' education
mothers_education = ER32011,  # Year mother born
fathers_education = ER32018,  # Year father born
# Family structure
parents_poor_childhood = V10988,  # Parents poor or well off (1984)
parent_college = V11956,    # Whether parent attended college
# Wealth during childhood
wealth_89 = S217,           # Family wealth in 1989
active_saving_84_89 = V17610,  # Change in wealth 1984-1989
# Other important variables from childhood
family_id_88 = ER30570,     # 1988 family ID
family_id_90 = ER30642      # 1990 family ID
)
# Load necessary packages
library(tidyverse)
library(readxl)  # For reading Excel files
# Read PSID data
# Assuming the data is stored in a format like .rds, .csv, or .dta
psid_data <- psid_data <- read_excel("/Users/user/Desktop/ECON491project/data/J347114.xlsx")
# Examine the structure of the data
str(psid_data)
head(psid_data)
# Expanded model dataset including childhood variables
model_df <- psid_data %>%
# Filter for individuals around age 35 in 2021
filter(ER34904 >= 34 & ER34904 <= 36) %>%
# Filter for individuals with valid income data
filter(!is.na(ER35049) | !is.na(ER35046)) %>%
select(
# Identifiers
individual_id = ER30002,  # Person number
family_id_2021 = ER34901,  # 2021 family ID
# Outcome variables - income in 2021
income_2021 = ER35049,     # Total taxable income
labor_income_2021 = ER35046, # Labor income
# Current demographics
sex = ER32000,
age_2021 = ER34904,
relation_to_head = ER34903,
# Education
attended_college = ER34930,
college_degree = ER34934,
years_education = ER34952,
# Current family background
parents_poor = ER81141,
# Wealth measures
wealth_2021 = ER81838,
family_income_2020 = ER81775,
# CHILDHOOD VARIABLES (1990s)
# Family income when child was around 4-10 years old
family_income_90 = V18875,   # 1989 family money income
family_income_92 = V20175,   # 1990 family money income
# Parents' education
mothers_education = ER32011,  # Year mother born
fathers_education = ER32018,  # Year father born
# Family structure
parents_poor_childhood = V10988,  # Parents poor or well off (1984)
parent_college = V11956,    # Whether parent attended college
# Wealth during childhood
wealth_89 = S217,           # Family wealth in 1989
active_saving_84_89 = V17610,  # Change in wealth 1984-1989
# Other important variables from childhood
family_id_88 = ER30570,     # 1988 family ID
family_id_90 = ER30642      # 1990 family ID
)
# Clean and prepare the data
model_df <- model_df %>%
# Create appropriate outcome variable
mutate(
final_income = coalesce(income_2021, labor_income_2021),
# Convert to factors
sex_factor = factor(sex, levels = c(1, 2), labels = c("Male", "Female")),
college_factor = factor(attended_college, levels = c(1, 5), labels = c("Yes", "No")),
degree_factor = factor(college_degree, levels = c(1, 5), labels = c("Yes", "No")),
parents_poor_factor = factor(parents_poor, levels = c(1, 3, 5),
labels = c("Poor", "Average", "Well Off")),
parents_poor_child_factor = factor(parents_poor_childhood, levels = c(1, 3, 5),
labels = c("Poor", "Average", "Well Off"))
) %>%
# Handle missing values
filter(!is.na(final_income))
# Examine the prepared dataset
summary(model_df)
View(model_df)
View(model_df)
View(model_df)
# Revised model dataset using broader economic indicators
model_df <- psid_data %>%
# Filter for individuals around age 35 in 2021
filter(ER34904 >= 34 & ER34904 <= 36) %>%
# Don't filter by individual income - instead keep people with any valid economic measure
filter(!is.na(ER81838) | !is.na(ER81775) | !is.na(ER35049) | !is.na(ER35046)) %>%
select(
# Identifiers
individual_id = ER30002,  # Person number
family_id_2021 = ER34901,  # 2021 family ID
# Multiple economic outcome options
indiv_income_2021 = ER35049,     # Individual total taxable income
indiv_labor_income_2021 = ER35046, # Individual labor income
family_income_2020 = ER81775,    # Total family income
family_wealth_2021 = ER81838,    # Family wealth with equity
# Current demographics
sex = ER32000,
age_2021 = ER34904,
relation_to_head = ER34903,
# Education
attended_college = ER34930,
college_degree = ER34934,
years_education = ER34952,
# Family background
parents_poor = ER81141,
# CHILDHOOD VARIABLES (1990s)
# Family income when child was around 4-10 years old
family_income_89 = V17533,   # 1988 family money income
family_income_90 = V18875,   # 1989 family money income
# Parents' education and background
parents_poor_childhood = V10988,  # Parents poor or well off (1984)
parent_attended_college = V11956, # Whether parent attended college
# Wealth during childhood
wealth_89 = S217,           # Family wealth in 1989
active_saving_84_89 = V17610  # Change in wealth 1984-1989
)
# Clean and prepare the data
model_df <- model_df %>%
mutate(
# Create composite economic outcome measure (could use any of these in models)
has_indiv_income = !is.na(indiv_income_2021) | !is.na(indiv_labor_income_2021),
indiv_income = coalesce(indiv_income_2021, indiv_labor_income_2021),
# Normalize economic measures to reduce skew
log_indiv_income = ifelse(has_indiv_income, log(indiv_income + 1), NA),
log_family_income = log(family_income_2020 + 1),
log_family_wealth = log(abs(family_wealth_2021) + 1) * sign(family_wealth_2021),
# Create factor variables
sex_factor = factor(sex, levels = c(1, 2), labels = c("Male", "Female")),
college_factor = factor(attended_college, levels = c(1, 5), labels = c("Yes", "No")),
degree_factor = factor(college_degree, levels = c(1, 5), labels = c("Yes", "No")),
parents_poor_factor = factor(parents_poor, levels = c(1, 3, 5),
labels = c("Poor", "Average", "Well Off")),
parents_poor_child_factor = factor(parents_poor_childhood, levels = c(1, 3, 5),
labels = c("Poor", "Average", "Well Off"))
)
summary(model_df)
# Revised model dataset using broader economic indicators
model_df <- psid_data %>%
# Filter for individuals around age 35 in 2021
filter(ER34904 >= 34 & ER34904 <= 36) %>%
# Don't filter by individual income - instead keep people with any valid economic measure
filter(!is.na(ER81838) | !is.na(ER81775) | !is.na(ER35049) | !is.na(ER35046)) %>%
select(
# Identifiers
individual_id = ER30002,  # Person number
family_id_2021 = ER34901,  # 2021 family ID
# Multiple economic outcome options
indiv_income_2021 = ER35049,     # Individual total taxable income
indiv_labor_income_2021 = ER35046, # Individual labor income
family_income_2020 = ER81775,    # Total family income
family_wealth_2021 = ER81838,    # Family wealth with equity
# Current demographics
sex = ER32000,
age_2021 = ER34904,
relation_to_head = ER34903,
# Education
attended_college = ER34930,
college_degree = ER34934,
years_education = ER34952,
# Family background
parents_poor = ER81141,
# CHILDHOOD VARIABLES (1990s)
# Family income when child was around 4-10 years old
family_income_89 = V17533,   # 1988 family money income
family_income_90 = V18875,   # 1989 family money income
# Parents' education and background
parents_poor_childhood = V10988,  # Parents poor or well off (1984)
parent_attended_college = V11956, # Whether parent attended college
# Wealth during childhood
wealth_89 = S217,           # Family wealth in 1989
active_saving_84_89 = V17610  # Change in wealth 1984-1989
)
# Clean and prepare the data
model_df <- model_df %>%
mutate(
# Create composite economic outcome measure (could use any of these in models)
has_indiv_income = !is.na(indiv_income_2021) | !is.na(indiv_labor_income_2021),
indiv_income = coalesce(indiv_income_2021, indiv_labor_income_2021),
# Normalize economic measures to reduce skew
log_indiv_income = ifelse(has_indiv_income, log(indiv_income + 1), NA),
log_family_income = log(family_income_2020 + 1),
log_family_wealth = log(abs(family_wealth_2021) + 1) * sign(family_wealth_2021),
# Create factor variables
sex_factor = factor(sex, levels = c(1, 2), labels = c("Male", "Female")),
college_factor = factor(attended_college, levels = c(1, 5), labels = c("Yes", "No")),
degree_factor = factor(college_degree, levels = c(1, 5), labels = c("Yes", "No")),
parents_poor_factor = factor(parents_poor, levels = c(1, 3, 5),
labels = c("Poor", "Average", "Well Off")),
parents_poor_child_factor = factor(parents_poor_childhood, levels = c(1, 3, 5),
labels = c("Poor", "Average", "Well Off"))
)
summary(model_df)
# Load necessary packages
library(tidyverse)
library(readxl)  # For reading Excel files
# Read PSID data
# Assuming the data is stored in a format like .rds, .csv, or .dta
psid_data <- psid_data <- read_excel("/Users/user/Desktop/ECON491project/data/J347114.xlsx")
# Examine the structure of the data
str(psid_data)
head(psid_data)
# Revised model dataset using broader economic indicators
model_df <- psid_data %>%
# Filter for individuals around age 35 in 2021
filter(ER34904 >= 30 & ER34904 <= 39) %>%
# Don't filter by individual income - instead keep people with any valid economic measure
filter(!is.na(ER81838) | !is.na(ER81775) | !is.na(ER35049) | !is.na(ER35046)) %>%
select(
# Identifiers
individual_id = ER30002,  # Person number
family_id_2021 = ER34901,  # 2021 family ID
# Multiple economic outcome options
indiv_income_2021 = ER35049,     # Individual total taxable income
indiv_labor_income_2021 = ER35046, # Individual labor income
family_income_2020 = ER81775,    # Total family income
family_wealth_2021 = ER81838,    # Family wealth with equity
# Current demographics
sex = ER32000,
age_2021 = ER34904,
relation_to_head = ER34903,
# Education
attended_college = ER34930,
college_degree = ER34934,
years_education = ER34952,
# Family background
parents_poor = ER81141,
# CHILDHOOD VARIABLES (1990s)
# Family income when child was around 4-10 years old
family_income_89 = V17533,   # 1988 family money income
family_income_90 = V18875,   # 1989 family money income
# Parents' education and background
parents_poor_childhood = V10988,  # Parents poor or well off (1984)
parent_attended_college = V11956, # Whether parent attended college
# Wealth during childhood
wealth_89 = S217,           # Family wealth in 1989
active_saving_84_89 = V17610  # Change in wealth 1984-1989
)
# Clean and prepare the data
model_df <- model_df %>%
mutate(
# Create composite economic outcome measure (could use any of these in models)
has_indiv_income = !is.na(indiv_income_2021) | !is.na(indiv_labor_income_2021),
indiv_income = coalesce(indiv_income_2021, indiv_labor_income_2021),
# Normalize economic measures to reduce skew
log_indiv_income = ifelse(has_indiv_income, log(indiv_income + 1), NA),
log_family_income = log(family_income_2020 + 1),
log_family_wealth = log(abs(family_wealth_2021) + 1) * sign(family_wealth_2021),
# Create factor variables
sex_factor = factor(sex, levels = c(1, 2), labels = c("Male", "Female")),
college_factor = factor(attended_college, levels = c(1, 5), labels = c("Yes", "No")),
degree_factor = factor(college_degree, levels = c(1, 5), labels = c("Yes", "No")),
parents_poor_factor = factor(parents_poor, levels = c(1, 3, 5),
labels = c("Poor", "Average", "Well Off")),
parents_poor_child_factor = factor(parents_poor_childhood, levels = c(1, 3, 5),
labels = c("Poor", "Average", "Well Off"))
)
summary(model_df)
View(model_df)
# Load necessary packages
library(tidyverse)
library(readxl)  # For reading Excel files
# Read PSID data
# Assuming the data is stored in a format like .rds, .csv, or .dta
psid_data <- psid_data <- read_excel("/Users/user/Desktop/ECON491project/data/J347114.xlsx")
# Examine the structure of the data
str(psid_data)
head(psid_data)
# Revised model dataset with expanded age range
model_df <- psid_data %>%
# Filter for individuals between 30-38 in 2021
filter(ER34904 >= 30 & ER34904 <= 38) %>%
# Include anyone with valid economic measures
filter(!is.na(ER81838) | !is.na(ER81775) | !is.na(ER35049) | !is.na(ER35046)) %>%
select(
# Identifiers
individual_id = ER30002,  # Person number
family_id_2021 = ER34901,  # 2021 family ID
# Current age
age_2021 = ER34904,
# Economic outcome measures
indiv_income_2021 = ER35049,     # Individual total taxable income
indiv_labor_income_2021 = ER35046, # Individual labor income
family_income_2020 = ER81775,    # Total family income
family_wealth_2021 = ER81838,    # Family wealth with equity
# Demographics
sex = ER32000,
relation_to_head = ER34903,
# Education
attended_college = ER34930,
college_degree = ER34934,
years_education = ER34952,
# Current family background perception
parents_poor = ER81141,
# CHILDHOOD VARIABLES (1980s-1990s)
# We need to capture childhood for people born 1983-1991
# Family income from childhood years
family_income_84 = V11022,   # 1983 family money income
family_income_86 = V13623,   # 1985 family money income
family_income_88 = V16144,   # 1987 family money income
family_income_89 = V17533,   # 1988 family money income
family_income_90 = V18875,   # 1989 family money income
family_income_92 = V20175,   # 1990 family money income
# Parents' background and education
parents_poor_childhood_84 = V10988,  # Parents poor or well off (1984)
parents_poor_childhood_89 = V17466,  # Parents poor or well off (1989)
parent_college_85 = V11956,  # Whether parent attended college (1985)
parent_college_89 = V17497,  # Whether parent attended college (1989)
# Parents' identifiers to capture parental characteristics
mother_person_id = ER32010,  # Person number of mother
father_person_id = ER32017,  # Person number of father
# Wealth measures during childhood periods
wealth_89 = S217,           # Family wealth in 1989
active_saving_84_89 = V17610  # Change in wealth 1984-1989
)
# Clean and prepare the data
model_df <- model_df %>%
mutate(
# Create birth year variable
birth_year = 2021 - age_2021,
# Create composite economic outcome measures
has_indiv_income = !is.na(indiv_income_2021) | !is.na(indiv_labor_income_2021),
indiv_income = coalesce(indiv_income_2021, indiv_labor_income_2021),
# Normalize economic measures to reduce skew
log_indiv_income = ifelse(has_indiv_income, log(indiv_income + 1), NA),
log_family_income = log(family_income_2020 + 1),
log_family_wealth = log(abs(family_wealth_2021) + 1) * sign(family_wealth_2021),
# Create childhood income variables based on appropriate years
# We'll select the income measure from when person was approximately age 5-10
childhood_income = case_when(
birth_year <= 1984 ~ family_income_84,
birth_year <= 1986 ~ family_income_86,
birth_year <= 1988 ~ family_income_88,
birth_year <= 1989 ~ family_income_89,
birth_year <= 1990 ~ family_income_90,
TRUE ~ family_income_92
),
# Similarly for parents' background
childhood_parents_poor = coalesce(parents_poor_childhood_84, parents_poor_childhood_89),
childhood_parent_college = coalesce(parent_college_85, parent_college_89),
# Create factor variables
sex_factor = factor(sex, levels = c(1, 2), labels = c("Male", "Female")),
college_factor = factor(attended_college, levels = c(1, 5), labels = c("Yes", "No")),
degree_factor = factor(college_degree, levels = c(1, 5), labels = c("Yes", "No")),
parents_poor_factor = factor(parents_poor, levels = c(1, 3, 5),
labels = c("Poor", "Average", "Well Off")),
childhood_parents_poor_factor = factor(childhood_parents_poor, levels = c(1, 3, 5),
labels = c("Poor", "Average", "Well Off")),
parent_college_factor = factor(childhood_parent_college, levels = c(1, 5),
labels = c("Yes", "No"))
)
# Create standardized economic outcome measure
model_df <- model_df %>%
mutate(
# Standardize each measure
z_indiv_income = scale(log_indiv_income, center = TRUE, scale = TRUE)[,1],
z_family_income = scale(log_family_income, center = TRUE, scale = TRUE)[,1],
z_family_wealth = scale(log_family_wealth, center = TRUE, scale = TRUE)[,1],
# Create composite (using mean of available measures)
economic_index = rowMeans(cbind(z_indiv_income, z_family_income, z_family_wealth),
na.rm = TRUE)
)
# Remove rows with NA in key variables for modeling
model_df_clean <- model_df %>%
filter(!is.na(economic_index)) %>%
filter(!is.na(sex_factor) & !is.na(years_education))
summary(model_df)
View(model_df_clean)
View(model_df)
# 1. Basic linear regression with composite economic index
basic_model <- lm(economic_index ~ sex_factor + years_education + degree_factor +
childhood_parents_poor_factor + parent_college_factor +
log(childhood_income + 1) + age_2021,
data = model_df_clean)
summary(basic_model)
# 2. Prepare for LASSO and cross-validation
library(glmnet)
library(caret)
install.packages(caret)
# Install required packages
install.packages("tidyverse")  # For data manipulation
install.packages("readxl")     # For reading Excel files
install.packages("glmnet")     # For LASSO regression
install.packages("caret")      # For cross-validation
install.packages("randomForest") # For tree-based models (if needed)
